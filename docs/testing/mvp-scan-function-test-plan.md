# MVPバーコードスキャン機能テスト計画

## テスト実施日

実施日: 2025-11-21
テスター: プロダクトオーナー
デバイス: iPhone 16 Pro (iOS 18.0.1)
ビルド: Release

---

## 事前準備

### 1. Notion環境準備

- [x] Notionワークスペースにログイン
- [x] テスト用データベース（Library DB）を作成または確認
  - データベースID: `51725b0ba8ca4c9db8d05228d1d8bf69`（既存）
  - 必要なプロパティ:
    - [x] `タイトル` (title)
    - [X] `著者名` (rich_text)
    - [x] `ISBN` (rich_text)
    - [x] `書影` (files)

- [x] Notion Integration作成・確認
  - [x] Integration Tokenを取得
  - [x] データベースへのアクセス権限を付与

### 2. テスト用書籍バーコード準備

以下のISBNコードを持つ書籍を準備してください：

**正常系テスト用:**
- [ ] ISBN-13: `9784297138783`（技術書 - 確実にOpenBDに存在）
- [ ] ISBN-10: `4297138783`（同上のISBN-10形式）
- [ ] ISBN-13: `9784798179070`（別の技術書）

**異常系テスト用:**
- [ ] 存在しないISBN: `9999999999999`
- [ ] 無効な形式: `123456`

---

## テストケース

### A. 初回起動・設定フロー

#### A-1. 初回起動確認

**手順:**
1. アプリを起動
2. 初回起動時のポップアップを確認

**期待結果:**
- [x] 「Notionとの連携が必要です」アラートが表示される
- [x] 「OK」ボタンをタップすると設定タブに移動する

#### A-2. Notion設定入力

**手順:**
1. 設定タブを開く
2. 以下の項目を入力:
   - Integration Token
   - Database ID: `51725b0ba8ca4c9db8d05228d1d8bf69`
3. プロパティマッピングを確認

**期待結果:**
- [x] Integration Token入力フィールドが表示される
- [x] Database ID入力フィールドが表示される
- [x] プロパティマッピング（タイトル、著者名、ISBN、書影）が表示される
- [ ] 入力内容が保存される

#### A-3. データベース接続確認

**手順:**
1. 設定完了後、スキャンタブに移動

**期待結果:**
- [x] エラーなくスキャン画面が表示される
- [x] カメラプレビューが表示される

---

### B. バーコードスキャン機能（正常系）

#### B-1. ISBN-13バーコードスキャン

**手順:**
1. スキャンタブを開く
2. ISBN-13バーコード（`9784297138783`）をカメラでスキャン

**期待結果:**
- [x] バーコード認識時にビープ音または振動
- [x] スキャン中のローディング表示
- [x] OpenBD APIからのデータ取得成功
- [x] 書籍情報表示画面に遷移
  - [x] タイトルが表示される
  - [x] 著者名が表示される
  - [x] ISBNが表示される
  - [x] 書影（カバー画像）が表示される

#### B-2. ISBN-10バーコードスキャン

**手順:**
1. ISBN-10バーコード（`4297138783`）をスキャン

**期待結果:**
- [ ] ISBN-13と同様に正常に認識
- [ ] 書籍情報が正しく表示される

#### B-3. Notion登録確認

**手順:**
1. 書籍情報表示画面で「登録」ボタンをタップ（またはNotionボタン）
2. 処理完了を待つ

**期待結果:**
- [ ] ローディング表示
- [ ] 「Notionに登録しました」成功メッセージ
- [ ] Notionデータベースを開いて確認
  - [ ] 新しいページが作成されている
  - [ ] タイトルが正しく設定されている
  - [ ] 著者名が正しく設定されている
  - [ ] ISBNが正しく設定されている
  - [ ] 書影がアップロードされている

#### B-4. 連続スキャン

**手順:**
1. 1冊目をスキャン・登録
2. スキャン画面に戻る
3. 2冊目（`9784798179070`）をスキャン・登録

**期待結果:**
- [x] スキャン画面に正常に戻れる
- [x] 2冊目も正常にスキャン・登録できる
- [x] Notionに2件のページが作成される

---

### C. バーコードスキャン機能（異常系）

#### C-1. 存在しないISBN

**手順:**
1. 存在しないISBN（`9999999999999`）をスキャン

**期待結果:**
- [ ] バーコードは認識される
- [ ] OpenBD APIでデータが見つからないエラー
- [ ] エラーメッセージが表示される
  - 例: 「書籍情報が見つかりませんでした」
- [ ] スキャン画面に戻れる

#### C-2. 無効なバーコード形式

**手順:**
1. ISBNではないバーコード（JANコードなど）をスキャン

**期待結果:**
- [x] バーコードは認識される
- [ ] ISBNフォーマットエラーメッセージ
  - 例: 「ISBNコードではありません」
- [x] スキャン画面に戻れる

#### C-3. ネットワークエラー

**手順:**
1. デバイスを機内モードにする
2. バーコードをスキャン

**期待結果:**
- [x] ネットワークエラーメッセージ
  - 例: 「ネットワークに接続できません」
- [x] スキャン画面に戻れる
- [x] 機内モード解除後、再スキャンで正常動作

#### C-4. Notion連携エラー

**手順:**
1. 設定で無効なIntegration Tokenを設定
2. バーコードをスキャンして登録を試みる

**期待結果:**
- [x] Notion APIエラーメッセージ
  - 例: 「Notionへの登録に失敗しました」
- [x] エラー詳細が表示される（401 Unauthorized等）

---

### D. UI/UX確認

#### D-1. カメラ権限

**手順:**
1. 初回スキャン時にカメラ権限ダイアログを確認

**期待結果:**
- [x] カメラ権限リクエストダイアログが表示される
- [x] 用途説明文が適切
  - 「書籍やアイテムのバーコードをスキャンするためにカメラを使用します」
- [x] 許可後、カメラプレビューが表示される

#### D-2. ナビゲーション

**手順:**
1. スキャンタブと設定タブを切り替える

**期待結果:**
- [x] タブ切り替えがスムーズ
- [x] 各タブのアイコン・ラベルが適切
- [x] アクティブタブが視覚的に明確

#### D-3. テーマ対応

**手順:**
1. iOSの設定でダークモード/ライトモードを切り替える
2. アプリを確認

**期待結果:**
- [x] ライトモードで正常表示
- [x] ダークモードで正常表示
- [x] 文字が読みやすい
- [x] 背景・前景色のコントラストが適切

#### D-4. 画面回転

**手順:**
1. デバイスを縦向き・横向きに回転

**期待結果:**
- [ ] レイアウトが崩れない
- [ ] カメラプレビューが適切にリサイズ
- [ ] ボタン・テキストが見切れない

---

### E. パフォーマンス確認

#### E-1. スキャン速度

**手順:**
1. バーコードをカメラにかざす
2. 認識までの時間を計測

**期待結果:**
- [x] 1秒以内にバーコードを認識
- [x] レスポンスが良好

#### E-2. API応答時間

**手順:**
1. バーコードスキャン後、書籍情報取得までの時間を計測

**期待結果:**
- [x] 3秒以内にOpenBDから情報取得
- [x] ローディング表示が適切

#### E-3. メモリ使用量

**手順:**
1. 10冊連続スキャン
2. アプリの動作を確認

**期待結果:**
- [　] アプリがクラッシュしない
- [　] メモリリークがない
- [　] 動作が重くならない

---

### F. データ整合性確認

#### F-1. プロパティマッピング検証

**手順:**
1. 書籍をスキャン・登録
2. Notionデータベースを確認

**期待結果:**
- [ ] タイトル → Notionの「タイトル」プロパティ
- [ ] 著者名 → Notionの「著者名」プロパティ
- [ ] ISBN → Notionの「ISBN」プロパティ
- [ ] 書影URL → Notionの「書影」プロパティ（ファイル）
- [ ] 日本語が文字化けしていない

#### F-2. 重複登録確認

**手順:**
1. 同じ書籍を2回スキャン・登録

**期待結果:**
- [ ] 2件のページが作成される（現状はMVPなので重複チェックなし）
- 【将来実装】重複チェックが動作する場合:
  - [ ] 重複警告が表示される
  - [ ] ユーザーに選択肢を提供

---

## テスト結果記録

### 実施結果サマリー

| カテゴリ | 総数 | 成功 | 失敗 | スキップ |
|---------|------|------|------|----------|
| A. 初回起動・設定 | 3 | 3 | 0 | 0 |
| B. 正常系スキャン | 4 | 2 | 1 | 1 |
| C. 異常系スキャン | 4 | 3 | 0 | 1 |
| D. UI/UX確認 | 4 | 3 | 0 | 1 |
| E. パフォーマンス | 3 | 2 | 0 | 1 |
| F. データ整合性 | 2 | 0 | 0 | 2 |
| **合計** | **20** | **13** | **1** | **6** |

### 発見された不具合

| ID | 重要度 | 概要 | 再現手順 | 期待動作 | 実際の動作 | ステータス |
|----|--------|------|----------|----------|------------|------------|
| BUG-001 | 高 | Notionへの保存が機能しない | 1. バーコードスキャン<br>2. 結果画面で「Notionに保存」ボタンをタップ | Notionにページが作成される | ボタンを押しても何も起こらない。エラーメッセージも表示されない | 調査中 |
| BUG-002 | 中 | ISBN手入力による情報取得が動作しない | 1. ISBNを手入力<br>2. 検索ボタンをタップ | OpenBDから書籍情報を取得 | 情報が取得されない | 未着手 |

### 改善提案

| ID | 優先度 | カテゴリ | 提案内容 |
|----|--------|----------|----------|
| IMP-001 | 低 | UI/UX | 画面回転対応は不要。縦画面のみで良い（プロダクトオーナー判断） |
| IMP-002 | 中 | エラー処理 | ISBNではないバーコードをスキャンした際、「ISBNを探しています」と表示されるが、エラーメッセージは不要。別のバーコードをスキャンできるため現状で問題なし |
| IMP-003 | 低 | テストケース | B-2（ISBN-10）とC-1（存在しないISBN）は任意のバーコード生成ツールがないとテスト不可 |

### 追加コメント

**成功した機能:**
- 初回起動フロー、Notion設定、カメラ権限は全て正常動作
- バーコードスキャンは高速（1秒以内）で認識
- OpenBD API連携は3秒以内で完了
- ネットワークエラー、Notion認証エラーのハンドリングは正常
- ダークモード/ライトモード対応は問題なし
- 連続スキャンは正常動作（B-4で確認）
- 10冊連続スキャンでもクラッシュなし、パフォーマンス良好

**スキップした機能:**
- ISBN-10スキャン（バーコード生成ツールがないため）
- 存在しないISBNスキャン（同上）
- 画面回転対応（縦画面のみで良いと判断）
- メモリ使用量詳細測定（クラッシュがないため問題なしと判断）
- プロパティマッピング検証（BUG-001が解決されるまで保留）
- 重複登録確認（BUG-001が解決されるまで保留）

---

## 承認

- [ ] 全テストケース実施完了
- [ ] クリティカルな不具合なし
- [ ] テスト結果をチームと共有

テスト実施者: ___________________
承認者: ___________________
日付: ___________________
