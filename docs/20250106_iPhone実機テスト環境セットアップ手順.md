# iPhone 16 Pro 実機テスト環境セットアップ手順

**作成日**: 2025年1月6日
**対象デバイス**: iPhone 16 Pro (プライベート利用端末)
**対象アプリ**: BarNoR (NotionBarcodeReader)

---

## 📋 前提条件

- ✅ Xcode がインストールされている (最新版推奨)
- ✅ Apple Developer アカウント (無料アカウントでもOK)
- ✅ iPhone 16 Pro とMacが同じApple IDでログインしている
- ✅ USB-C to USB-Cケーブル (またはLightning to USB-C)

---

## 🔧 STEP 1: Xcodeプロジェクトの設定

### 1-1. Xcodeでプロジェクトを開く

```bash
cd /Users/bon/dev/NotionBarcodeReader
open ios/NotionBarcodeReader.xcworkspace
```

**重要**: `.xcworkspace` を開いてください（`.xcodeproj` ではありません）

### 1-2. Signing & Capabilities の設定

1. **左側のプロジェクトナビゲーターで `NotionBarcodeReader` を選択**
2. **TARGETS → NotionBarcodeReader を選択**
3. **Signing & Capabilities タブを開く**
4. **Team の設定**:
   - "Automatically manage signing" にチェック ✅
   - Team: あなたのApple IDアカウントを選択
   - Bundle Identifier: `com.clevique.barnor` (または自動生成されたもの)

5. **証明書の自動生成**:
   - Xcodeが自動的に開発者証明書とプロビジョニングプロファイルを作成します
   - 初回は「"codesign" wants to access key "..." in your keychain」と表示されたら、パスワードを入力して「常に許可」を選択

---

## 📱 STEP 2: iPhone 16 Pro の準備

### 2-1. 開発者モードの有効化

**iPhone 16 Pro (iOS 16以降) では開発者モードの有効化が必須です**

1. **iPhoneの設定アプリを開く**
2. **「プライバシーとセキュリティ」→「デベロッパモード」**
3. **デベロッパモードをオン**
4. **再起動を要求されるので、再起動する**
5. **再起動後、確認ダイアログが表示されるので「オンにする」**

### 2-2. MacとiPhoneの接続

1. **USB-Cケーブルでiphone 16 ProとMacを接続**
2. **iPhoneに「このコンピュータを信頼しますか？」が表示されたら「信頼」をタップ**
3. **iPhoneのパスコードを入力**

### 2-3. Xcodeでデバイスを認識

1. **Xcode上部のデバイス選択部分を確認**
2. **「bon's iPhone」または「iPhone 16 Pro」が表示されているか確認**
3. **表示されない場合**:
   - Xcode → Window → Devices and Simulators
   - 左側のリストでiPhoneが表示されるか確認
   - "Show as run destination" にチェック

---

## 🚀 STEP 3: ビルド & インストール

### 3-1. CocoaPodsの依存関係インストール

```bash
cd /Users/bon/dev/NotionBarcodeReader/ios
bundle exec pod install
```

### 3-2. Xcodeでビルド

1. **デバイス選択**: Xcode上部で「bon's iPhone」または「iPhone 16 Pro」を選択
2. **スキーム選択**: 「NotionBarcodeReader」を選択
3. **ビルド実行**: ⌘ + R (またはビルドボタン▶️)

### 3-3. 初回ビルド時の注意

**「Untrusted Developer」エラーが出る場合**:

1. **iPhoneの設定アプリを開く**
2. **「一般」→「VPNとデバイス管理」**
3. **「デベロッパApp」セクションで あなたのApple ID を選択**
4. **「信頼」をタップ**
5. **Xcodeで再度ビルド実行**

---

## ✅ STEP 4: 動作確認

### 4-1. アプリ起動確認

- ✅ アプリがiPhoneにインストールされて起動する
- ✅ ホーム画面が表示される
- ✅ ダークモード切り替えが動作する

### 4-2. カメラ権限確認

1. **スキャンタブをタップ**
2. **「カメラへのアクセスを許可しますか？」が表示されたら「許可」**
3. **カメラプレビューが表示されるか確認**

### 4-3. Notion連携確認

1. **設定タブを開く**
2. **Notion Integration Token を入力**
3. **保存が成功するか確認**
4. **「✓ Notionに接続されています」が表示されるか確認**

### 4-4. E2Eテスト（書籍スキャン）

1. **パッケージ管理タブで「書籍登録」パッケージをアクティブ化**
2. **スキャンタブでISBNバーコードをスキャン**
3. **書籍情報が自動取得されるか確認**
4. **Notionデータベースに保存されるか確認**

---

## 🐛 トラブルシューティング

### ビルドエラー: "No signing certificate"

**原因**: 開発者証明書が未設定
**解決策**:
1. Xcode → Settings → Accounts
2. Apple IDを追加
3. Signing & Capabilitiesで "Automatically manage signing" をオン

### ビルドエラー: "Library not found"

**原因**: CocoaPodsの依存関係が未インストール
**解決策**:
```bash
cd ios
bundle exec pod deintegrate
bundle exec pod install
```

### 実機で起動しない: "Could not launch app"

**原因**: 開発者モードが無効化されている
**解決策**:
1. iPhone → 設定 → プライバシーとセキュリティ → デベロッパモード
2. オンにして再起動

### カメラが真っ黒: "Camera permission denied"

**原因**: カメラ権限が拒否されている
**解決策**:
1. iPhone → 設定 → NotionBarcodeReader → カメラ
2. 「許可」に変更

### Notion連携エラー: "Invalid token"

**原因**: Integration Tokenが間違っている
**解決策**:
1. https://www.notion.so/my-integrations
2. 新しいIntegrationを作成
3. Tokenをコピーしてアプリに貼り付け

---

## 📝 補足情報

### デバッグログの確認

**Xcodeコンソールでログを確認**:
1. Xcode → View → Debug Area → Show Debug Area (⌘ + Shift + Y)
2. コンソールにログが表示される
3. エラーメッセージをコピーして調査

### デバイス上のアプリデータ削除

**アプリを完全にクリーンインストールしたい場合**:
1. iPhoneでアプリを長押し
2. 「Appを削除」→「Appを削除」
3. Xcodeで再度ビルド

### ワイヤレスデバッグ（オプション）

**USB接続なしでビルド・デバッグ**:
1. Xcode → Window → Devices and Simulators
2. iPhoneを選択
3. "Connect via network" にチェック
4. USB接続を解除しても、同一Wi-Fiネットワークでデバッグ可能

---

## 🎯 次のステップ

実機テストが成功したら:

1. **TestFlight配布準備**
   - App Store Connect でアプリ登録
   - アーカイブ作成 (Product → Archive)
   - TestFlightにアップロード

2. **本番リリース準備**
   - Privacy Policy/Terms of Service URL登録
   - App Storeスクリーンショット作成
   - アプリ説明文作成

3. **App Store審査提出**
   - App Review Information 記入
   - 審査提出

---

**作成者**: ClaudeCode
**最終更新**: 2025年1月6日
