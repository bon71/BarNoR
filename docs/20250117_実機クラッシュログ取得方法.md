# 実機クラッシュログ取得方法

実機でアプリがクラッシュする場合、ログを取得して原因を特定する必要があります。

## 方法1: Xcodeのデバイスログを使用（推奨）

### 手順

1. **Xcodeを起動**
2. **Window > Devices and Simulators** を開く（または `Cmd + Shift + 2`）
3. 左側のデバイス一覧から **16pro.bon** を選択
4. 右側の **Open Console** ボタンをクリック
5. アプリを実機で起動
6. コンソールにクラッシュログが表示される

### ログの見方

- **赤色のエラーメッセージ**: クラッシュの直接的な原因
- **スタックトレース**: どのコードでクラッシュしたか
- 検索バーで `NotionBarcodeReader` や `error` でフィルタリング

## 方法2: コマンドラインでログ取得

### libimobiledeviceのインストール

```bash
brew install libimobiledevice
```

### ログのリアルタイム取得

```bash
idevicesyslog | grep -i "NotionBarcodeReader\|error\|crash"
```

### ログをファイルに保存

```bash
idevicesyslog > /tmp/ios-device-log.txt
```

アプリを起動してクラッシュさせた後、`Ctrl+C`でログ取得を停止し、ファイルを確認します。

## 方法3: Xcodeでデバッグビルド

### 手順

1. Xcodeで `ios/NotionBarcodeReader.xcworkspace` を開く
2. 上部のデバイス選択で **16pro.bon** を選択
3. **Product > Run** または `Cmd + R` でビルド・実行
4. クラッシュ時にXcodeのデバッガーが停止し、クラッシュ箇所を表示

## よくあるクラッシュ原因

### 1. カメラパーミッション関連

**症状**: アプリ起動直後にクラッシュ

**確認方法**:
- Info.plistに `NSCameraUsageDescription` が設定されているか
- 実機の設定 > プライバシー > カメラ で権限が許可されているか

### 2. React Native Vision Camera初期化エラー

**症状**: スキャン画面を開くとクラッシュ

**確認方法**:
```bash
# Podの再インストール
cd ios
bundle exec pod deintegrate
bundle exec pod install
cd ..
```

### 3. メモリ不足

**症状**: 何度か操作した後にクラッシュ

**確認方法**: Xcodeの Memory Debugger を使用

### 4. ネイティブモジュールのリンクエラー

**症状**: 特定の機能を使用するとクラッシュ

**確認方法**:
```bash
# キャッシュクリア＆再ビルド
npx react-native clean
cd ios
rm -rf build
rm -rf ~/Library/Developer/Xcode/DerivedData/*
bundle exec pod install
cd ..
npm run ios
```

## クラッシュログの読み方

### 例: クラッシュログ

```
2025-01-17 11:48:00.123 NotionBarcodeReader[1234:567890] *** Terminating app due to uncaught exception 'NSInvalidArgumentException', reason: '-[RCTCameraView setCameraId:]: unrecognized selector sent to instance 0x123456789'
```

- **例外タイプ**: `NSInvalidArgumentException`
- **原因**: `RCTCameraView` に存在しないメソッド `setCameraId:` を呼び出している
- **解決策**: React Native Vision Cameraのバージョン不整合や、Podの再インストールが必要

## 次のステップ

1. 上記の方法でログを取得
2. ログに含まれるエラーメッセージを確認
3. エラーメッセージをClaudeCodeに共有
4. 原因特定と修正を実施
