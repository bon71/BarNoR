# CIä¾å­˜é–¢ä¿‚ã‚¨ãƒ©ãƒ¼è§£æ±ºå®Ÿè£…æŒ‡ç¤ºæ›¸

## ğŸ“‹ å•é¡Œã®åˆ†æ

### ä¸»è¦ã‚¨ãƒ©ãƒ¼

```
npm error Error: Patch file found for package @react-native/virtualized-lists
npm error command failed: yarn run postinstall
npm error Command failed: patch-package
```

### éæ¨å¥¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è­¦å‘Š

1. **`@testing-library/jest-native@5.4.3`**: éæ¨å¥¨ã€`@testing-library/react-native` v12.4+ã«çµ±åˆæ¸ˆã¿
2. **`eslint@8.19.0`**: ãƒãƒ¼ã‚¸ãƒ§ãƒ³8ç³»ã¯éã‚µãƒãƒ¼ãƒˆ
3. **`rimraf@3.0.2`, `rimraf@2.4.5`**: v4æœªæº€ã¯éã‚µãƒãƒ¼ãƒˆ
4. **`glob@7.2.3`, `6.0.4`, `8.1.0`**: v9æœªæº€ã¯éã‚µãƒãƒ¼ãƒˆ
5. **`inflight@1.0.6`**: ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯å•é¡Œã‚ã‚Šã€éã‚µãƒãƒ¼ãƒˆ
6. **`@humanwhocodes/object-schema`, `@humanwhocodes/config-array`**: ESLintã®å¤ã„ä¾å­˜é–¢ä¿‚

### æ ¹æœ¬åŸå› 

1. **patch-packageã®å¤±æ•—**: `@react-native+virtualized-lists+0.81.0.patch` ãŒé©ç”¨ã§ããªã„
   - React Native 0.81.0ã§ã¯ã€ã“ã®ãƒ‘ãƒƒãƒãŒä¸è¦ã«ãªã£ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
   - ã¾ãŸã¯ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹é€ ãŒå¤‰ã‚ã‚Šãƒ‘ãƒƒãƒãƒ•ã‚¡ã‚¤ãƒ«ãŒé©ç”¨ã§ããªããªã£ãŸ

2. **éæ¨å¥¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸**: å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒä¾å­˜é–¢ä¿‚ã«å«ã¾ã‚Œã¦ã„ã‚‹

## ğŸ¯ è§£æ±ºæ–¹é‡

### ãƒ•ã‚§ãƒ¼ã‚º1: ãƒ‘ãƒƒãƒãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œè¨¼ã¨ä¿®æ­£
1. ãƒ‘ãƒƒãƒãŒæœ¬å½“ã«å¿…è¦ã‹ç¢ºèª
2. ä¸è¦ãªã‚‰å‰Šé™¤ã€å¿…è¦ãªã‚‰å†ç”Ÿæˆ

### ãƒ•ã‚§ãƒ¼ã‚º2: éæ¨å¥¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å‰Šé™¤ãƒ»æ›´æ–°
1. `@testing-library/jest-native` ã®å‰Šé™¤
2. `eslint` ã®æ›´æ–°ï¼ˆv9ç³»ã¸ï¼‰
3. ãã®ä»–ã®ä¾å­˜é–¢ä¿‚ã®æ›´æ–°

### ãƒ•ã‚§ãƒ¼ã‚º3: CIç’°å¢ƒã®æœ€é©åŒ–
1. npm ciã®ä½¿ç”¨ï¼ˆnpm installã§ã¯ãªãï¼‰
2. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æ´»ç”¨

## ğŸ“ å®Ÿè£…å†…å®¹

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ‘ãƒƒãƒãƒ•ã‚¡ã‚¤ãƒ«ã®å¿…è¦æ€§ç¢ºèª

**å®Ÿæ–½å†…å®¹**:

1. **ãƒ‘ãƒƒãƒãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤ãƒ†ã‚¹ãƒˆ**
   ```bash
   # ãƒ‘ãƒƒãƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸€æ™‚çš„ã«ãƒªãƒãƒ¼ãƒ 
   mv patches/@react-native+virtualized-lists+0.81.0.patch patches/@react-native+virtualized-lists+0.81.0.patch.bak

   # ä¾å­˜é–¢ä¿‚ã‚’å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
   rm -rf node_modules package-lock.json
   npm install

   # ã‚¢ãƒ—ãƒªãŒæ­£å¸¸ã«èµ·å‹•ã™ã‚‹ã‹ç¢ºèª
   npm run ios
   ```

2. **çµæœåˆ¤å®š**:
   - âœ… **å•é¡Œãªãèµ·å‹•**: ãƒ‘ãƒƒãƒã¯ä¸è¦ â†’ å‰Šé™¤ã™ã‚‹
   - âŒ **ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ**: ãƒ‘ãƒƒãƒãŒå¿…è¦ â†’ å†ç”Ÿæˆã™ã‚‹

### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ‘ãƒƒãƒãŒä¸è¦ãªå ´åˆã®å¯¾å¿œ

**package.json ã®ä¿®æ­£**:

```json
{
  "scripts": {
    "android": "react-native run-android",
    "ios": "node scripts/run-ios.mjs",
    "publish:notion": "node scripts/publish-notion-summary.mjs",
    "lint": "eslint .",
    "start": "node scripts/start-metro.mjs",
    "test": "jest",
    "test:perf": "node scripts/performance-test.mjs",
    // âœ… postinstallã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å‰Šé™¤ï¼ˆãƒ‘ãƒƒãƒãŒä¸è¦ãªã‚‰ï¼‰
    // "postinstall": "patch-package",
    "kill-cache-deep": "bash scripts/kill-cache-deep.sh"
  },
  "devDependencies": {
    // ... ä»–ã®ä¾å­˜é–¢ä¿‚ ...
    // âœ… patch-packageã¨postinstall-postinstallã‚’å‰Šé™¤
    // "patch-package": "^8.0.1",
    // "postinstall-postinstall": "^2.1.0",
    // ... ä»–ã®ä¾å­˜é–¢ä¿‚ ...
  }
}
```

**å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰**:
```bash
# ãƒ‘ãƒƒãƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
rm -rf patches/

# package.jsonã‹ã‚‰ä¸è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å‰Šé™¤
npm uninstall patch-package postinstall-postinstall
```

### ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ‘ãƒƒãƒãŒå¿…è¦ãªå ´åˆã®å¯¾å¿œ

**ãƒ‘ãƒƒãƒãƒ•ã‚¡ã‚¤ãƒ«ã®å†ç”Ÿæˆ**:

```bash
# 1. æ—¢å­˜ã®ãƒ‘ãƒƒãƒã‚’å‰Šé™¤
rm -rf patches/

# 2. ã‚¯ãƒªãƒ¼ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
rm -rf node_modules package-lock.json
npm install

# 3. å¿…è¦ãªä¿®æ­£ã‚’node_modulesã«é©ç”¨
# ï¼ˆãƒ‘ãƒƒãƒãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’æ‰‹å‹•ã§é©ç”¨ï¼‰

# 4. æ–°ã—ã„ãƒ‘ãƒƒãƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
npx patch-package @react-native/virtualized-lists
```

### ã‚¹ãƒ†ãƒƒãƒ—4: éæ¨å¥¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å‰Šé™¤

**`@testing-library/jest-native` ã®å‰Šé™¤**:

```bash
npm uninstall @testing-library/jest-native
```

**ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿®æ­£** (å¿…è¦ã«å¿œã˜ã¦):

ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰:
```typescript
import '@testing-library/jest-native/extend-expect';
```

ä¿®æ­£å¾Œ:
```typescript
// @testing-library/react-native v12.4+ ã§ã¯çµ„ã¿è¾¼ã¿ãƒãƒƒãƒãƒ£ãƒ¼ã‚’ä½¿ç”¨
// importæ–‡ã¯ä¸è¦
```

ã¾ãŸã¯ã€`@testing-library/react-native` v12.4ä»¥ä¸Šã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰:
```bash
npm install --save-dev @testing-library/react-native@latest
```

### ã‚¹ãƒ†ãƒƒãƒ—5: ESLintã®æ›´æ–°

**ESLint v9ã¸ã®æ›´æ–°**:

```bash
# ESLint v9ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
npm install --save-dev eslint@^9.0.0

# React Nativeå…¬å¼ã®ESLintè¨­å®šã‚‚æ›´æ–°
npm install --save-dev @react-native/eslint-config@latest
```

**eslint.config.js ã®ä½œæˆ** (v9ã§ã¯Flat Configã‚’ä½¿ç”¨):

```javascript
// eslint.config.js
import reactNativeConfig from '@react-native/eslint-config';

export default [
  {
    ignores: ['node_modules/**', 'android/**', 'ios/**', '.expo/**'],
  },
  ...reactNativeConfig,
];
```

**æ³¨æ„**: ESLint v9ã¸ã®ç§»è¡Œã¯ç ´å£Šçš„å¤‰æ›´ãŒå¤šã„ãŸã‚ã€æ…é‡ã«å®Ÿæ–½ã€‚
v8ç³»ã‚’ç¶­æŒã™ã‚‹å ´åˆã¯ã€è­¦å‘Šã‚’ç„¡è¦–ã—ã¦v8ã®æœ€æ–°ç‰ˆã«æ›´æ–°:

```bash
npm install --save-dev eslint@^8.57.1
```

### ã‚¹ãƒ†ãƒƒãƒ—6: package.json ã®æœ€çµ‚æ›´æ–°

**æ¨å¥¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³**:

```json
{
  "devDependencies": {
    "@babel/core": "^7.25.2",
    "@babel/preset-env": "^7.25.3",
    "@babel/runtime": "^7.25.0",
    "@react-native-community/cli": "^19.1.2",
    "@react-native-community/cli-platform-android": "19.0.0",
    "@react-native-community/cli-platform-ios": "19.0.0",
    "@react-native/babel-preset": "0.81.0",
    "@react-native/eslint-config": "0.81.0",
    "@react-native/metro-config": "0.81.0",
    "@react-native/typescript-config": "0.81.0",
    // âœ… @testing-library/jest-nativeã‚’å‰Šé™¤
    "@testing-library/react-native": "^13.3.3",
    "@types/jest": "^29.5.14",
    "@types/node": "^24.10.0",
    "@types/react": "^19.0.0",
    "@types/react-test-renderer": "^19.0.0",
    "babel-plugin-module-resolver": "^5.0.2",
    "detox": "^20.45.1",
    // âœ… ESLint v8ã®æœ€æ–°ç‰ˆã«æ›´æ–°ï¼ˆv9ã¸ã®ç§»è¡Œã¯æ…é‡ã«ï¼‰
    "eslint": "^8.57.1",
    "get-port": "^7.1.0",
    "jest": "^29.6.3",
    "jest-circus": "^30.2.0",
    // âœ… patch-packageé–¢é€£ã‚’å‰Šé™¤ï¼ˆãƒ‘ãƒƒãƒãŒä¸è¦ãªå ´åˆï¼‰
    "prettier": "2.8.8",
    "react-test-renderer": "19.1.0",
    "typescript": "^5.8.3"
  }
}
```

### ã‚¹ãƒ†ãƒƒãƒ—7: CIãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æœ€é©åŒ–

**`.github/workflows/ci.yml` ã®ä¿®æ­£** (ä¾‹):

```yaml
name: CI

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci  # âœ… npm installã§ã¯ãªãnpm ciã‚’ä½¿ç”¨

      - name: Run linter
        run: npm run lint

      - name: Run tests
        run: npm test
```

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ**:
- `npm ci` ã‚’ä½¿ç”¨ï¼ˆ`npm install` ã‚ˆã‚Šé«˜é€Ÿã§ç¢ºå®Ÿï¼‰
- `cache: 'npm'` ã§node_modulesã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- `package-lock.json` ã‚’å¿…ãšã‚³ãƒŸãƒƒãƒˆ

## ğŸ§ª å‹•ä½œç¢ºèªæ–¹æ³•

### ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®ç¢ºèª

```bash
# 1. ã‚¯ãƒªãƒ¼ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
rm -rf node_modules package-lock.json
npm install

# 2. ãƒ“ãƒ«ãƒ‰ç¢ºèª
npm run ios

# 3. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm test

# 4. Lintç¢ºèª
npm run lint
```

### CIç’°å¢ƒã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

```bash
# package-lock.jsonã‚’ä½¿ã£ãŸç¢ºå®šçš„ãªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
rm -rf node_modules
npm ci

# ã™ã¹ã¦ã®ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
npm run lint && npm test
```

## âš ï¸ æ³¨æ„äº‹é …

### ãƒ‘ãƒƒãƒãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤ã«ã¤ã„ã¦

- **å‰Šé™¤å‰ã«å¿…ãšãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–ã‚‹**
  ```bash
  cp -r patches/ patches.backup/
  ```

- **å‹•ä½œç¢ºèªã‚’ååˆ†ã«è¡Œã†**
  - iOSå®Ÿæ©Ÿã§ã®å‹•ä½œç¢ºèª
  - Androidã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§ã®å‹•ä½œç¢ºèª
  - ä¸»è¦ãªç”»é¢é·ç§»ã®ãƒ†ã‚¹ãƒˆ

### ESLintæ›´æ–°ã«ã¤ã„ã¦

- **v9ã¸ã®ç§»è¡Œã¯ç ´å£Šçš„å¤‰æ›´ãŒå¤šã„**
  - æ—¢å­˜ã® `.eslintrc.js` ãŒä½¿ãˆãªããªã‚‹
  - Flat Configå½¢å¼ã¸ã®ç§»è¡ŒãŒå¿…è¦
  - ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®äº’æ›æ€§ç¢ºèªãŒå¿…è¦

- **æ¨å¥¨**: ã¾ãšã¯v8ã®æœ€æ–°ç‰ˆï¼ˆ8.57.1ï¼‰ã«æ›´æ–°ã—ã€è­¦å‘Šã‚’è§£æ¶ˆ
  - ãã®å¾Œã€æ™‚é–“ã‚’ã‹ã‘ã¦v9ã¸ã®ç§»è¡Œã‚’è¨ˆç”»

### éæ¨å¥¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã¤ã„ã¦

- **é–“æ¥ä¾å­˜é–¢ä¿‚ã®è­¦å‘Šã¯ç„¡è¦–ã—ã¦OK**
  - `rimraf`, `glob`, `inflight` ç­‰ã¯ä»–ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒä¾å­˜ã—ã¦ã„ã‚‹
  - ç›´æ¥ä¾å­˜é–¢ä¿‚ã§ã¯ãªã„ãŸã‚ã€ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆä¸è¦

- **ç›´æ¥ä¾å­˜é–¢ä¿‚ã®ã¿å¯¾å¿œã™ã‚‹**
  - `@testing-library/jest-native`: å‰Šé™¤
  - `eslint`: æ›´æ–°

## ğŸ“… å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

### ãƒ•ã‚§ãƒ¼ã‚º1: ç·Šæ€¥å¯¾å¿œï¼ˆå³æ—¥ï¼‰
1. **ãƒ‘ãƒƒãƒãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤ãƒ†ã‚¹ãƒˆ**: 30åˆ†
2. **ä¸è¦ãªãƒ‘ãƒƒãƒãƒ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å‰Šé™¤**: 15åˆ†
3. **CIå‹•ä½œç¢ºèª**: 30åˆ†

### ãƒ•ã‚§ãƒ¼ã‚º2: æœ€é©åŒ–ï¼ˆ1-2æ—¥ï¼‰
1. **éæ¨å¥¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å‰Šé™¤**: 1æ™‚é–“
2. **ESLintã®æ›´æ–°**: 2æ™‚é–“
3. **ãƒ†ã‚¹ãƒˆã®ä¿®æ­£**: 1æ™‚é–“
4. **CIè¨­å®šã®æœ€é©åŒ–**: 1æ™‚é–“

### ãƒ•ã‚§ãƒ¼ã‚º3: æ¤œè¨¼ï¼ˆ1æ—¥ï¼‰
1. **å…¨æ©Ÿèƒ½ã®å‹•ä½œç¢ºèª**: 2æ™‚é–“
2. **å®Ÿæ©Ÿãƒ†ã‚¹ãƒˆ**: 2æ™‚é–“
3. **CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ç¢ºèª**: 1æ™‚é–“

**åˆè¨ˆæ‰€è¦æ™‚é–“**: 2-3æ—¥

## âœ… å®Œäº†æ¡ä»¶

- [ ] patch-packageã®ã‚¨ãƒ©ãƒ¼ãŒè§£æ¶ˆ
- [ ] CIç’°å¢ƒã§npm ciãŒæˆåŠŸ
- [ ] éæ¨å¥¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è­¦å‘Šã‚’æœ€å°åŒ–ï¼ˆé–“æ¥ä¾å­˜é–¢ä¿‚ã‚’é™¤ãï¼‰
- [ ] ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šé
- [ ] ESLintã‚¨ãƒ©ãƒ¼ãŒã‚¼ãƒ­
- [ ] iOSå®Ÿæ©Ÿã§æ­£å¸¸ã«å‹•ä½œ
- [ ] Androidå®Ÿæ©Ÿã§æ­£å¸¸ã«å‹•ä½œ
- [ ] CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒã‚°ãƒªãƒ¼ãƒ³

## ğŸ”„ ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯:

```bash
# 1. å¤‰æ›´å‰ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ
cp patches.backup/* patches/

# 2. package.jsonã‚’å…ƒã«æˆ»ã™
git checkout package.json

# 3. ä¾å­˜é–¢ä¿‚ã‚’å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
rm -rf node_modules package-lock.json
npm install
```

---

## ğŸ“Š æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

| æŒ‡æ¨™ | æ”¹å–„å‰ | æ”¹å–„å¾Œ | æ”¹å–„ç‡ |
|------|--------|--------|--------|
| CIãƒ“ãƒ«ãƒ‰æˆåŠŸç‡ | 0% (å¤±æ•—) | 100% | **100%æ”¹å–„** |
| npm installæ™‚é–“ | - | 30%çŸ­ç¸® | **npm ciä½¿ç”¨** |
| éæ¨å¥¨è­¦å‘Šæ•° | 10+ | 2-3 | **70%å‰Šæ¸›** |

---

**ä½œæˆæ—¥**: 2025-01-18
**å¯¾è±¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: MVP v1.0
**é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«**:
- `package.json`
- `patches/@react-native+virtualized-lists+0.81.0.patch`
- `.github/workflows/*.yml`

**å„ªå…ˆåº¦**: **P1ï¼ˆç·Šæ€¥ï¼‰** - CIãŒå®Œå…¨ã«åœæ­¢ã—ã¦ã„ã‚‹ãŸã‚ã€æœ€å„ªå…ˆã§å¯¾å¿œ
